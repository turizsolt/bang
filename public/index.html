<!DOCTYPE html>
<html>
<head>
  <title>Player view</title>
  <script src="https://unpkg.com/vue"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="index.js"></script>
  <link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <div id="app">
    <div v-if="gameState === 'lobby'">
      <div v-if="!chosenDevice">
        You are viewing this on {{ chosenDevice }}
        <button v-on:click="setDevice('mobile')">Mobile</button>
        <button v-on:click="setDevice('desktop')">Screen</button>

      </div>
      <div v-else>
        <div>ez egy {{chosenDevice}}</div><span>{{claimedPlayers}}</span>
        <ol>
          <li v-for="player in players">
            {{ player.name }} <button v-on:click="claimPlayer(player.name)" 
                                      v-if="canBeClaimed(player)">Claim</button>
                              <button v-on:click="unclaimPlayer(player.name)" 
                                      v-if="player[chosenDevice] === deviceId">Unclaim</button>        
                                      <span>{{player.desktop}}</span>
                                      @
                                      <span>{{player.mobile}}</span>
                                      <span v-if="player[chosenDevice] === deviceId">ez vagyok én</span>
          </li>
        </ol>
      </div>
    </div>
    <div v-if="gameState === 'game'">
      <div v-if="startable" class="overlay">
        <div class="overlayInner">
          <button v-on:click="startTurn">Kör megkezdése</button>
        </div>
      </div>
      <div v-if="scores.winner" class="overlay">
        <div class="overlayInnerBox">
          Játék vége <br>
          Nyertes: {{scores.winner}}
        </div>
      </div> 
      <div class="topContainer">    
        <div class="remainingContainer">
          Dobások
          <div class="remainingCountContainer">
            <div v-bind:class="{remaining: true, done: usedRolls > i}" v-for="(roll, i) in rolls">{{usedRolls > i ? "X" : roll + 1}}</div>
          </div>
        </div>
        <div class="phaseContainer">
        Fázis
        <div class="dieOrderContainer">
          <div v-for="(dice, index) in dieOrder" v-bind:class="{dieOrderElement:true, current:index === currentOrder}">
            <img v-for="die in dice" class="dieElement" v-bind:src="`/${die}.png`" />
          </div>
        </div>
      </div>
    </div>
      <div class="diceHolder">
          <div class="diceBg">
            <div class="bowlRoll">Dob<br /></div>
            <div class="bowlKeep">Megtart<br /></div>
          </div>
          <div class="die" 
                v-for="(die, index) in dice" 
                
                v-bind:class="{ shake: shaking && !isFixed[index] , fixed: isFixed[index], used: isUsed[index], using: using === index, ordered: dieOrder[currentOrder].includes(die.topFace) }" />
            <img v-bind:src="`/${die.topFace}.png`" v-on:click="fixDie(index)"  />
          
          </div>
      </div>      
      <div class="button-holder-holder">
        <div class="button-holder">
          <button class="roll" v-on:click="roll">Dobok</button>
        </div>
        <div class="button-holder">
          <button class="keep" v-on:click="finish">Kész</button>
        </div>
      </div>     
      
      <div id="playingArea">
        <div class="arrowHolder">Nyilak: {{scores.arrows}}</div>
        <div class="scoreHolder">
          <div 
            v-for="(player, index) in scores.players" 
            v-bind:class="{score:true, dead: player.lives <= 0, current: currentPlayer === index}"
            v-bind:style="{left: `${600-300*Math.sin(Math.PI*2/scores.players.length*index)}px`, top: `${300+300*Math.cos(Math.PI*2/scores.players.length*index)}px`}">
            {{player.player.name}}
            <span v-if="player.role === 'seriff' || player.lives === 0">Szerep: {{player.role}}</span><br>
            Nyilak: {{player.arrows}}<br>
            Töltények: {{player.lives}}<br>
            <!--<div class="bullet-holder">
              <img v-for="i in player.lives" src="/bullet.png" />
            </div>-->
            <button v-if="using !== -1" v-on:click="chooseTarget(index)" v-bind:disabled="!targetablePlayers[index]">Kiválaszt</button>
          </div>
        </div>
      </div>
    </div>

  </div>

</body>
</html>